var M=Object.defineProperty;var T=(n,e,t)=>e in n?M(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var l=(n,e,t)=>(T(n,typeof e!="symbol"?e+"":e,t),t);const S=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerpolicy&&(r.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?r.credentials="include":i.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}};S();class m{constructor(e,t=Math.random()>.8?4:2){l(this,"_element");l(this,"_value");l(this,"_x");l(this,"_y");this._element=document.createElement("li"),this._element.setAttribute("data-tile",""),e.element.append(this._element),this.value=t}get value(){return this._value}set value(e){this._value=e,this.element.textContent=`${e}`,this.element.setAttribute("data-value",`${e}`)}get element(){return this._element}get x(){return this._x}set x(e){this._x=e,this.element.style.setProperty("--x",`${e}`)}get y(){return this._y}set y(e){this._y=e,this.element.style.setProperty("--y",`${e}`)}waitForTransition(e=!1){return new Promise(t=>{this.element.addEventListener(e?"animationend":"transitionend",t,{once:!0})})}remove(){this.element.remove()}}const g={down:n=>n.cellsByColumn.map(e=>[...e].reverse()),right:n=>n.cellsByRow.map(e=>[...e].reverse()),up:n=>n.cellsByColumn,left:n=>n.cellsByRow};class y{constructor(e){l(this,"_board");l(this,"_events",{});l(this,"touchStartX",0);l(this,"touchStartY",0);this._board=e,this.bindEvents(),this.bindTouchEvents()}bindTouchEvents(){this._board.element.addEventListener("touchstart",e=>{this.touchStartX=e.touches[0].clientX,this.touchStartY=e.touches[0].clientY}),this._board.element.addEventListener("touchmove",e=>{e.preventDefault()},{passive:!1}),this._board.element.addEventListener("touchend",e=>{if(this.touchStartX===0&&this.touchStartY===0)return;const t=e.changedTouches[0].clientX,s=e.changedTouches[0].clientY,i=t-this.touchStartX,r=s-this.touchStartY;let o="";const h=30;(Math.abs(i)>h||Math.abs(r)>h)&&(Math.abs(i)>Math.abs(r)?i>0?o="right":o="left":r>0?o="down":o="up"),o&&this.move(o),this.touchStartX=0,this.touchStartY=0})}bindEvents(){window.addEventListener("keydown",e=>this.move(e.key.replace("Arrow","").toLowerCase()),{once:!0})}async move(e){if(this.isEnded())return this.trigger("gameEnded");e in g?await this.slide(g[e](this._board)):this.bindEvents(),this.trigger("moved")}isEnded(){return Object.keys(g).every(e=>!this.canMove(g[e](this._board)))}canMove(e){return e.some(t=>t.some((s,i)=>i===0||s.tile===null?!1:t[i-1].canAccept(s.tile)))}async slide(e){this.canMove(e)&&(await y.slideTiles(e),this._board.cells.forEach(t=>{const s=t.mergeTiles();s!==0&&this.trigger("scoreUp",s)}),this._board.randomEmptyCell().tile=new m(this._board)),this.bindEvents()}static slideTiles(e){return Promise.all(e.flatMap(t=>{const s=[];for(let i=1;i<t.length;i++){const r=t[i];if(r.tile===null)continue;let o;for(let h=i-1;h>=0;h--){const p=t[h];if(!p.canAccept(r.tile))break;o=p}o&&(s.push(r.tile.waitForTransition()),o.tile?o.tileToMerge=r.tile:o.tile=r.tile,r.tile=null)}return s}))}on(e,t){this._events[e]=t}trigger(e,...t){if(this._events[e]){const s=this._events[e];s(...t)}}}class E{constructor(e,t){l(this,"_x");l(this,"_y");l(this,"_element");l(this,"_tile",null);l(this,"_tileToMerge",null);this._x=e,this._y=t;const s=document.createElement("li");s.setAttribute("data-cell",""),this._element=s}get x(){return this._x}get y(){return this._y}get element(){return this._element}get tile(){return this._tile}set tile(e){this._tile=e,this.tile!==null&&(this.tile.x=this.x,this.tile.y=this.y)}get tileToMerge(){return this._tileToMerge}set tileToMerge(e){this._tileToMerge=e,this.tileToMerge!==null&&(this.tileToMerge.x=this.x,this.tileToMerge.y=this.y)}canAccept(e){return this.tile===null||this.tileToMerge===null&&this.tile.value===e.value}mergeTiles(){return this.tile==null||this.tileToMerge==null?0:(this.tile.value+=this.tileToMerge.value,this.tileToMerge.remove(),this.tileToMerge=null,this.tile.value)}removeTiles(){var e,t;(e=this.tile)==null||e.remove(),(t=this.tileToMerge)==null||t.remove(),this.tileToMerge=null,this.tile=null}}const c=class{constructor(e){l(this,"_cells",[]);l(this,"_element");if(e==null)throw new Error("Board cannot be null");e.style.setProperty("--grid-size",`${c.gridSize}`),document.body.style.setProperty("--f-size",`${c.gridSize/(c.gridSize-2.4)}rem`),this._element=e,Array(c.gridSize*c.gridSize).fill(0).map((t,s)=>{const i=new E(s%c.gridSize,Math.floor(s/c.gridSize));this._element.append(i.element),this._cells.push(i)})}get element(){return this._element}get cells(){return this._cells}get emptyCells(){return this.cells.filter(e=>e.tile===null)}randomEmptyCell(){const e=Math.floor(Math.random()*this.emptyCells.length);return this.emptyCells[e]}get cellsByRow(){return this.cells.reduce((e,t)=>(e[t.y]=e[t.y]||[],e[t.y][t.x]=t,e),[])}get cellsByColumn(){return this.cells.reduce((e,t)=>(e[t.x]=e[t.x]||[],e[t.x][t.y]=t,e),[])}};let d=c;l(d,"gridSize",4);localStorage.getItem("gridSize")&&(d.gridSize=+localStorage.getItem("gridSize"));const u=document.querySelector("[data-score]"),b=document.querySelector("[data-best]"),v=document.querySelector("[data-message]"),w=v.querySelector("button"),a=new d(document.querySelector("[data-board]")),f=new y(a);a.randomEmptyCell().tile=new m(a);a.randomEmptyCell().tile=new m(a);w.addEventListener("click",()=>{v.classList.remove("visible"),a.cells.forEach(n=>n.removeTiles()),a.randomEmptyCell().tile=new m(a),a.randomEmptyCell().tile=new m(a),u.innerHTML=`${0}`});f.on("scoreUp",n=>{u.innerHTML=`${+u.innerHTML+n}`});f.on("gameEnded",()=>{+u.innerHTML>+localStorage.getItem("best-score")&&(localStorage.setItem("best-score",u.innerHTML),b.innerHTML=u.innerHTML),v.classList.add("visible"),f.bindEvents()});var _;b.innerHTML=(_=localStorage.getItem("best-score"))!=null?_:"0";
